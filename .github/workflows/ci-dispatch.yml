name: CI for Repository Dispatch

on:
  repository_dispatch:
    types: ["test_dispatch"]

permissions:
  contents: read

jobs:
  test:
    runs-on: ubuntu-latest
    steps:
      - name: Show received client_payload
        env:
          CLIENT_PAYLOAD: ${{ toJson(github.event.client_payload) }}
        run: |
          echo "Client Payload"
          echo "$CLIENT_PAYLOAD"

      - name: Validate payload schema
        env:
          CLIENT_PAYLOAD: ${{ toJson(github.event.client_payload) }}
        run: |
          command -v jq >/dev/null 2>&1 || { echo 'jq not found' >&2; exit 1; }
          echo "$CLIENT_PAYLOAD" | jq -e '.requested_by | length > 0' >/dev/null || {
            echo "Missing or empty 'requested_by' field" >&2; exit 1;
          }
          echo "Payload schema valid"
